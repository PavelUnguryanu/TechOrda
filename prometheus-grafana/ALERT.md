# Инструкция по настройке Alert в Grafana
1. Создание Alert'а для панели Grafana
Откройте Grafana и перейдите на ваш дашборд, например, "API Dashboard".
Выберите панель, для которой хотите создать алерт (например, "Calculator Errors").
Нажмите на название панели, выберите Edit для редактирования панели.
В меню сверху перейдите на вкладку Alert.
Нажмите Create Alert Rule для создания правила алерта.
Настройка условий Alert'а
Дайте название вашему алерту, например, Calculator Errors.
В разделе Create a query to be alerted on настройте метрику:
Выберите источник данных Prometheus.
В поле Query используйте следующую формулу для расчета ошибок:

rate(calculator_errors_total[5m])

Укажите интервал обновления, например, 5m.
Перейдите к следующему блоку Define alert conditions:
Установите условие, при котором срабатывает алерт:
WHEN last() OF A IS ABOVE 0. Это означает, что алерт сработает, если количество ошибок на /calculator начнёт расти.
Установите период для проверки срабатывания алерта, например, Every 1m (каждую минуту).
2. Настройка уведомлений в Telegram
Для отправки уведомлений в Telegram вам потребуется бот и его API токен.

Создание бота Telegram
Откройте Telegram и найдите бота @BotFather.
В диалоге с @BotFather введите команду /newbot.
Следуйте инструкциям для создания бота и получения токена API.
Сохраните токен, он понадобится для настройки Grafana.
Получение ID чата Telegram
Найдите и начните диалог с ботом, которого вы только что создали.
Откройте ссылку https://api.telegram.org/bot<ВашТокен>/getUpdates (замените <ВашТокен> на токен вашего бота).
Отправьте любое сообщение своему боту.
В ответе вы увидите chat.id, который потребуется для настройки уведомлений.
3. Настройка контакта для Alert в Grafana
В Grafana перейдите в Alerting > Contact points.
Нажмите New contact point и дайте ему название, например, Telegram Alerts.
Выберите Type > Webhook.
В поле Url введите следующий адрес:
https://api.telegram.org/bot<ВашТокен>/sendMessage
Замените <ВашТокен> на API токен вашего бота.
В разделе Custom headers добавьте новый заголовок:
Key: Content-Type
Value: application/json
В поле Body введите JSON для отправки сообщения:
{
  "chat_id": "<ВашChatID>",
  "text": "Alert! Ошибки в /calculator увеличились!"
}
Замените <ВашChatID> на ID чата из предыдущего шага.
4. Привязка контактного пункта к алерту
Перейдите к созданному алерту на панели и в разделе Alert выберите Notification.
Укажите ваш контактный пункт (Telegram Alerts) в качестве получателя уведомлений.
Сохраните изменения в алерте.
5. Проверка Alert'а
Чтобы проверить, что алерт работает, вызовите несколько ошибок в роуте /calculator, отправив к нему несколько запросов, которые вызовут ошибки.

